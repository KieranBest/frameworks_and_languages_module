<html>
<head>
   <meta charset="utf-8" />
   <link id="favicon" rel="shortcut icon" type="image/png" href="data:image/png;base64,....==" />
   <title>FreeCycle</title>

   <style>

   </style>

   <script src="https://unpkg.com/vue@3/dist/vue.global.js">
   </script>

</head>
<body>
   <h1>FreeCycle</h1>
   <div id="app">
     <form  @:submit.prevent="create_item" data-field="user_id">
       User Id: <input v-model="Item.user_id" name="user_id" type="text" placeholder="type your name in"><br>
       Keywords: <input v-model="Item.keywords" name="keywords" type="text" placeholder="type some keywords"><br>
       Description: <textarea v-model="Item.description" name="description" type="text" placeholder="enter a description"></textarea><br>       
       Image: <input v-model="Item.image" name="image" type="url" placeholder="input your image url"><br>
       Latitude: <input v-model="Item.lat" name="lat" type="text" placeholder="type your latitude"><br>
       Longitude: <input v-model="Item.lon" name="lon" type="text" placeholder="type your longitude"><br>
       <button data-action="create_item">Submit</button>
     </form>
     <ul>
       <li v-for="Item in Items">
         <span data-field="id">{{Item.id}}</span>
         User Id: <span>{{Item.user_id}}</span>
         Keywords: <span>{{Item.keywords}}</span>
         Description: <span>{{Item.description}}</span>
         <span>Image.url='{{Item.image}}'</span>
         Latitude: <span>{{Item.lat}}</span>
         Longitude: <span>{{Item.lon}}</span>
         <button @click="delete_item(Item.id)" data-action="delete">Delete</button>
       </li>
     </ul>
   </div>
<script type="module">
const { createApp } = Vue

const DEFAULT_API = '/api/v1';  // default to current http(s)://currentHost:currentPort/api/v1'
const urlParams = new URLSearchParams(window.location.search);
const urlAPI = (urlParams.get('api') || '/api/v1').replace(/\/$/, '');

createApp({
  data(){
    return {
        Item: {
          id:'',
          user_id:'',
          keywords:'',
          description:'',
          image:'',
          lat:'',
          lon:'',
          date_from:'',
          date_to:''
        },
        Items: [],
  }
},
  created() {
   this.clear_Item()
   this.get_Items()
},
  methods: {
    clear_Item() {
      this.Item = { ...this.Item, ...{
        user_id: '',
        keywords: '',
        description: '',
        image: '',
        lat: '',
        lon: '',
      }}
    },
    create_item() {
      fetch(`${urlAPI}/item`, {
        method:'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(this.Item),
      })         
        .then(response => response.json())
        .then(json => console.log('create_item()',json))
        .then(this.clear_Item)
        .then(this.get_Items)
        .catch(err=>console.error(err));
    },
    get_Items() {
      fetch(`${urlAPI}/items`, {
        method: 'GET',
      })
      .then(response => response.json())
      .then(data => this.Items = data)
      .catch(err => console.error(err));
    },
    delete_item(id){
      fetch(`${urlAPI}/item/${id}`,{
        method: 'DELETE',
      })
      .then (json => console.log('delete_item()', json))
      .then (this.get_Items)
        .catch(err=>console.error(err));
    }
  }
}).mount('#app')

</script>
</body>
</html>